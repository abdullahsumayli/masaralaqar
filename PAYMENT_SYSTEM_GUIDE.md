# ูุธุงู ุงูุฏูุน ูุงูุงุดุชุฑุงูุงุช - ุฏููู ุดุงูู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทora ูุธุงู ุงุดุชุฑุงู ูุชูุงูู ุจู **Supabase** ูุฏุนู:
- โ ุฎุทุท ุงุดุชุฑุงู ูุฑูุฉ (ูุฌุงููุฉุ ุฃุณุงุณูุฉุ ุงุญุชุฑุงููุฉ)
- โ ุชุญูููุงุช ุจูููุฉ ูุจุงุดุฑุฉ
- โ ููุญุฉ ุฅุฏุงุฑุฉ ูุชูุฏูุฉ ููุชุญูู ูู ุงูุฏูุนุงุช
- โ ูุธุงู ููุงุชูุฑ ุชููุงุฆู
- โ ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช ุงููุณุชุฎุฏููู

---

## ๐๏ธ ูุนูุงุฑูุฉ ุงููุธุงู

### ูุงุนุฏุฉ ุงูุจูุงูุงุช

```
database/
โโโ subscription_plans        (3 ุฎุทุท ุงูุชุฑุงุถูุฉ)
โโโ user_subscriptions        (ุงุดุชุฑุงู ุงููุณุชุฎุฏููู)
โโโ bank_transfers           (ุชุญูููุงุช ุจูููุฉ)
โโโ invoices                 (ุงูููุงุชูุฑ)
```

### ุงููุณุงุฑุงุช ูุงูุตูุญุงุช

```
Frontend:
โโโ /pricing                  โ ุนุฑุถ ุงูุฎุทุท
โโโ /subscribe?plan=X        โ ุตูุญุฉ ุงูุฏูุน
โโโ /dashboard               โ ููุญุฉ ูุณุชุฎุฏู
โ   โโโ /settings            โ ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงู
โโโ /admin/payments          โ ุฅุฏุงุฑุฉ ุงูุฏูุนุงุช
โโโ /admin/invoices          โ ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ

API/Functions:
โโโ /lib/payments.ts         โ ุฌููุน ุงูุนูููุงุช
```

---

## ๐ณ ุฎุทุท ุงูุงุดุชุฑุงู

### ุงูุฎุทุท ุงูุงูุชุฑุงุถูุฉ

#### 1๏ธโฃ ูุฌุงููุฉ (Free)
```
- ุงูุณุนุฑ: 0 ุฑ.ุณ
- ุงูุนูุงุฑุงุช: 5
- ุงูุนููุงุก: 50
- ุงูุชุฎุฒูู: 1 GB
- ุงูููุฒุงุช ุงูุฃุณุงุณูุฉ
```

#### 2๏ธโฃ ุฃุณุงุณูุฉ (Basic)
```
- ุงูุณุนุฑ: 299 ุฑ.ุณ/ุดูุฑ
- ุงูุนูุงุฑุงุช: 50
- ุงูุนููุงุก: 500
- ุงูุชุฎุฒูู: 10 GB
+ ุฅุฏุงุฑุฉ ุนููุงุก ูุชูุฏูุฉ
+ ุชุญููู ุชูุตููู
+ ุฏุนู ุจุฑูุฏู
```

#### 3๏ธโฃ ุงุญุชุฑุงููุฉ (Pro)
```
- ุงูุณุนุฑ: 799 ุฑ.ุณ/ุดูุฑ
- ุงูุนูุงุฑุงุช: 500
- ุงูุนููุงุก: 5000
- ุงูุชุฎุฒูู: 100 GB
+ ุฌููุน ููุฒุงุช Basic
+ API Access
+ ุฏุนู ุตูุชู
+ ูุณุคูู ุญุณุงุจ ูุฎุตุต
```

---

## ๐ ุชุฏูู ุงูุงุดุชุฑุงู

### 1๏ธโฃ ูููุณุชุฎุฏู ุงูุฐู ูุฑุบุจ ุจุงูุชุฑูู

```
/pricing
  โ (ุงุฎุชูุงุฑ ุฎุทุฉ)
/subscribe?plan=basic
  โ (ููุก ุจูุงูุงุช ุงูุจูู)
โ ุชุฃููุฏ ุงูุฏูุน
  โ (ุฑูุซูุง ุงูุชุญูู ูู ุงูุฅุฏุงุฑุฉ)
/dashboard
  โ (ุงูุชุธุงุฑ ุงูุจุฑูุฏ ุงูุชุฃููุฏู)
โ ูุนูุงูุฉ ุงูุฎุทุฉ (ุจุนุฏ ุงูุชุญูู)
```

### 2๏ธโฃ ูููุณุคูู (ุงูุชุญูู)

```
/admin/payments
  โ (ุนุฑุถ ุงูุฏูุนุงุช ุงููุนููุฉ)
  โ (ุชุฏููู ุงูุจูุงูุงุช ุงูุจูููุฉ)
  โ (ุงุฎุชูุงุฑ: ุชุฃููุฏ ุฃู ุฑูุถ)
[ุชุฃููุฏ]
  โ
โ ุชูุนูู ุงูุงุดุชุฑุงู ุชููุงุฆูุงู
๐ง ุฅุฑุณุงู ุจุฑูุฏ ุชุฃููุฏู ูููุณุชุฎุฏู
```

---

## ๐ ุจูุงูุงุช ุงูุชุญููู ุงูุจููู

ุนูุฏ ุงุฎุชูุงุฑ ุฎุทุฉ ูุฏููุนุฉุ ูููุฃ ุงููุณุชุฎุฏู:

```typescript
{
  bankName: "ุงูุจูู ุงูุฃููู"           // ุงุณู ุงูุจูู
  accountNumber: "1234567890"         // ุฑูู ุญุณุงุจู
  transferDate: "2026-02-18"         // ุชุงุฑูุฎ ุงูุชุญููู
  referenceNumber: "ABC123456"       // ุฑูู ุงููุฑุฌุน ูู ุงููุธุงู ุงูุจููู
}
```

### ุจูุงูุงุช ุญุณุงุจูุง ุงูุจููู (ูุฌุจ ุชุญุฏูุซูุง)

```
ุงูุจูู: ุงูุจูู ุงูุฃููู ุงูุณุนูุฏู
ุงูุญุณุงุจ: 1234567890
IBAN: SA0012345678901234567890
ุงููุณุชูุจู: ูุณุงุฑ ุงูุนูุงุฑ
```

---

## ๐ป ูุงุฌูุงุช ุจุฑูุฌูุฉ (API)

### ูู `src/lib/payments.ts`

#### ุงูุฎุทุท
```typescript
// ุงูุญุตูู ุนูู ุฌููุน ุงูุฎุทุท
const plans = await getSubscriptionPlans()

// ุงูุญุตูู ุนูู ุฎุทุฉ ูุงุญุฏุฉ
const plan = await getSubscriptionPlan('basic')
```

#### ุงูุงุดุชุฑุงูุงุช
```typescript
// ุงูุญุตูู ุนูู ุงุดุชุฑุงู ุงููุณุชุฎุฏู ุงูุญุงูู
const subscription = await getUserSubscription(userId)

// ุฅูุดุงุก ุงุดุชุฑุงู ุฌุฏูุฏ
const newSub = await createUserSubscription(userId, 'basic')

// ุชุญุฏูุซ ุงูุงุดุชุฑุงู
await updateUserSubscription(subId, { status: 'active' })
```

#### ุงูุชุญูููุงุช ุงูุจูููุฉ
```typescript
// ุฅุฑุณุงู ุชุญููู ุจููู ุฌุฏูุฏ
const transfer = await submitBankTransfer(userId, {
  amount_sar: 299,
  plan_name: 'basic',
  bank_name: 'ุงูุจูู ุงูุฃููู',
  account_number: '123456',
  transfer_date: '2026-02-18',
  reference_number: 'ABC123'
})

// ุงูุญุตูู ุนูู ุชุญูููุงุช ุงููุณุชุฎุฏู
const transfers = await getUserBankTransfers(userId)

// [Admin] ุงูุชุญูู ูู ุงูุชุญููู
await verifyBankTransfer(transferId, true, adminId, notes)
```

#### ุงูููุงุชูุฑ
```typescript
// ุฅูุดุงุก ูุงุชูุฑุฉ
const invoice = await createInvoice(userId, {
  amount_sar: 299,
  description: 'ุงุดุชุฑุงู ูู ุงูุฎุทุฉ ุงูุฃุณุงุณูุฉ',
  payment_id: transferId
})

// ุงูุญุตูู ุนูู ููุงุชูุฑ ุงููุณุชุฎุฏู
const invoices = await getUserInvoices(userId)

// ุชุญุฏูุซ ุญุงูุฉ ุงููุงุชูุฑุฉ
await markInvoicePaid(invoiceId)
```

---

## ๐ฃ๏ธ ุงููุณุงุฑุงุช ูุงูุตูุญุงุช

### ุตูุญุฉ ุงูุฎุทุท (`/pricing`)

```
- ุนุฑุถ 3 ุฎุทุท
- ุฃุณุนุงุฑ ูุงุถุญุฉ
- ุงูููุฒุงุช ููู ุฎุทุฉ
- ุฃุฒุฑุงุฑ "ุงุฎุชุฑ ุงูุฎุทุฉ"
- ุฃุณุฆูุฉ ุดุงุฆุนุฉ
```

**ุงูููู:** [src/app/pricing/page.tsx](src/app/pricing/page.tsx)

### ุตูุญุฉ ุงูุฏูุน (`/subscribe`)

```
- ุจูุงูุงุช ุงูุฎุทุฉ ุงููุฎุชุงุฑุฉ
- ุจูุงูุงุช ุญุณุงุจูุง ุงูุจููู
- ูููุฐุฌ ุฅุฏุฎุงู ุจูุงูุงุช ุงูุชุญููู
- ุชุฃููุฏ ุนูููุฉ ุงูุฏูุน
- ุฑุณุงูุฉ ูุฌุงุญ ูุน ุฑูู ุงูุทูุจ
```

**ุงูููู:** [src/app/subscribe/subscribe-content.tsx](src/app/subscribe/subscribe-content.tsx)

### ููุญุฉ ุฅุฏุงุฑุฉ ุงูุฏูุนุงุช (`/admin/payments`)

```
- ุนุฑุถ ุฌููุน ุงูุชุญูููุงุช
- ุชุตููุฉ: ูุนููุฉ / ููุซูุฉ / ูุฑููุถุฉ
- ุจุญุซ ุจุฑูู ุงููุฑุฌุน
- ุนุฑุถ ุชูุงุตูู ูุงููุฉ ููุชุญููู
- ุฃุฒุฑุงุฑ: ุชุฃููุฏ / ุฑูุถ
- ูุงูุฐุฉ ููููุงุญุธุงุช
```

**ุงูููู:** [src/app/admin/payments/page.tsx](src/app/admin/payments/page.tsx)

### ููุญุฉ ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ (`/admin/invoices`)

```
- ุนุฑุถ ุฌููุน ุงูููุงุชูุฑ
- ุฅุญุตุงุฆูุงุช: ูุฏููุนุฉ / ุตุงุฏุฑุฉ / ูุชุฃุฎุฑุฉ
- ุจุญุซ ุจุฑูู ุงููุงุชูุฑุฉ
- ุนุฑุถ ุงูุชูุงุตูู ุงููุงููุฉ
- ุชุญููู ุงููุงุชูุฑุฉ (PDF/TXT)
```

**ุงูููู:** [src/app/admin/invoices/page.tsx](src/app/admin/invoices/page.tsx)

---

## ๐ Row Level Security (RLS)

### ุงูุฏูุนุงุช ุงูุจูููุฉ

```sql
-- ุงููุณุชุฎุฏู ูุฑู ุฏูุนุงุชู ููุท
SELECT * FROM bank_transfers WHERE user_id = auth.uid()

-- ุงููุณุคูู ูุฑู ุฌููุน ุงูุฏูุนุงุช
[ูุน role = 'admin']

-- ุงููุณุคูู ูููู ุชุนุฏูู ุญุงูุฉ ุงูุฏูุน
UPDATE bank_transfers SET status = 'verified'
```

### ุงูููุงุชูุฑ

```sql
-- ุงููุณุชุฎุฏู ูุฑู ููุงุชูุฑู ููุท
SELECT * FROM invoices WHERE user_id = auth.uid()

-- ุงููุณุคูู ูุฑู ุฌููุน ุงูููุงุชูุฑ
[ูุน role = 'admin']
```

---

## ๐ ููููุฉ ุงูุชุญูู ูู ุงูุฏูุนุงุช

### ุจุฏูู ุฃุชูุชุฉ ุดุงููุฉ

1. **ุงููุณุชุฎุฏู ูุฑุณู ุงูุชุญููู:**
   - ูููุฃ ูููุฐุฌ ุงูุฏูุน
   - ูููุฑ: "ุชุฃููุฏ ุงูุฏูุน"
   - ูุชููู: ุฑูู ุทูุจ + ุฑุณุงูุฉ ุงูุชุธุงุฑ

2. **ุงููุณุคูู ููุญุต:**
   - ูุฏุฎู `/admin/payments`
   - ูุฑู ุฌููุน ุงูุชุญูููุงุช ุงููุนููุฉ
   - ูุชุญูู ูู ุงูุชูุงุตูู (ุงูุจููุ ุงูุญุณุงุจ)
   - ูููุฑ: "ุชุฃููุฏ" ุฃู "ุฑูุถ"

3. **ุงูุชูุนูู ุงูุชููุงุฆู:**
   - ุนูุฏ "ุชุฃููุฏ" โ ูุญูู ุงูุงุดุชุฑุงู ุฅูู `active`
   - ูุชู ุฅูุดุงุก ูุงุชูุฑุฉ ุฑุณููุฉ
   - ููุฑุณู ุจุฑูุฏ ุชุฃููุฏ ูููุณุชุฎุฏู

### ูุน ุฃุชูุชุฉ (ูุณุชูุจู)

ูููู ุงูุฑุจุท ูุน:
- API ุจูููุฉ ููุชุญูู ุงูุชููุงุฆู
- ุฎุฏูุฉ ุชุญููู ุฃููุงู (ูุซู Telrุ PayTabs)
- ูุธุงู ุฑุณุงุฆู SMS/Email

---

## ๐จ ุฑุณุงุฆู ุงูุจุฑูุฏ (ูุณุชูุจู)

```
ุนูุฏ ุงูุชุณุฌูู: ุชุฑุญูุจ + ุชูุนูู ุงูุญุณุงุจ
ุนูุฏ ุงุฎุชูุงุฑ ุฎุทุฉ: ุชุฃููุฏ ุงูุทูุจ
ุนูุฏ ุงูุชุญูู: ุชูุนูู ุงูุฎุทุฉ + ุดูุฑ
ุนูุฏ ุงูุชูุงุก ุงูุงุดุชุฑุงู: ุชุฐููุฑ ุจุงูุชุฌุฏูุฏ
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ูุงูุชุญูููุงุช

### ูููู ุฅุถุงูุฉ:

1. **ุนุฏุฏ ุงููุดุชุฑููู ุจูู ุฎุทุฉ**
   ```sql
   SELECT plan_name, COUNT(*) FROM user_subscriptions
   WHERE status = 'active'
   GROUP BY plan_name
   ```

2. **ุงูุฅูุฑุงุฏุงุช ุงููููุฉ**
   ```sql
   SELECT SUM(amount_sar) FROM bank_transfers
   WHERE status = 'verified'
   ```

3. **ูุนุฏู ุงูุชุญููู (Conversion Rate)**
   ```
   (ุนุฏุฏ ุชุญูููุงุช ููุซูุฉ / ุนุฏุฏ ุงูุฏูุนุงุช ุงููุฑุณูุฉ) ร 100
   ```

---

## โ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: ุงูุฏูุน ูุง ููุนูุณ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

- โ ุชุญูู: Supabase SQL Schema ุชู ุชุดุบูููุ
- โ ุชุญูู: RLS Policies ูุนูุงูุฉุ
- โ ุชุญูู: Client ูููู ุงูุตูุงุญูุงุช ุงููุงุฒูุฉุ

### ุฎุทุฃ: ุงููุณุคูู ูุง ูุฑู ุงูุฏูุนุงุช

- โ ุชุญูู: ูู ุงููุณุชุฎุฏู `role = 'admin'`ุ
- โ ุชุญูู: ูู ุงุณุชุฏุนุงุก `verifyBankTransfer` ุตุญูุญุ

### ุฎุทุฃ: ุงูุงุดุชุฑุงู ูุง ููุดุท ุจุนุฏ ุงูุชุญูู

- โ ุชุญูู: `updateUserSubscription` ูุชู ุงุณุชุฏุนุงุคูุงุ
- โ ุชุญูู: subscription_id ููุฌูุฏ ูู bank_transferุ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### 1. ุชุดุบูู SQL Schema

```sql
-- ูู Supabase Dashboard โ SQL Editor
-- ุงูุณุฎ: supabase/payment-schema.sql
-- ุซู: ุงุถุบุท Run
```

โ

### 2. ุชุญุฏูุซ ุจูุงูุงุช ุงูุจูู

ูู `src/app/subscribe/subscribe-content.tsx`:

```typescript
// ุงุจุญุซ ุนู "ุจูุงูุงุช ุญุณุงุจูุง ุงูุจููู"
// ุญุฏูุซ ุจุงูุจูุงูุงุช ุงูุญููููุฉ ููุดุฑูุฉ
{
  bank_name: "ุงูุจูู ุงููุนูู",
  account: "ุงูุญุณุงุจ ุงููุนูู",
  iban: "IBAN ุงููุนูู"
}
```

โ

### 3. ุงุฎุชุจุงุฑ ุงูุชุฏูู

1. ุงุฐูุจ ุฅูู `/pricing`
2. ุงุฎุชุฑ ุฎุทุฉ (ูุซู Basic)
3. ููุฃ ุจูุงูุงุช ุชุญููู ููููุฉ
4. ุงููุฑ "ุชุฃููุฏ"
5. ุชุญูู: ูู ุธูุฑ ูู `/admin/payments`ุ
6. ููุณุคูู: ุงููุฑ "ุชุฃููุฏ"
7. ุชุญูู: ูู ุชุบูุฑุช ุญุงูุฉ ุงูุงุดุชุฑุงูุ

โ

### 4. ุฅุถุงูุฉ ุฑุณุงุฆู ุจุฑูุฏ

```typescript
// ุนูุฏ ุชุฃููุฏ ุงูุฏูุน:
await sendEmail({
  to: user.email,
  subject: "ุชู ุชูุนูู ุงุดุชุฑุงูู",
  template: "subscription_verified"
})
```

โ

### 5. ุฑุจุท ูุน ูุธุงู CRM

```typescript
// ุนูุฏ ุชูุนูู ุงูุฎุทุฉ Pro:
await assignCRMManager(userId, {
  feature: 'dedicated_manager'
})
```

---

## ๐ ุงูุชูุงุตู ูุงูุฏุนู

ููุฃุณุฆูุฉ ุฃู ุงููุณุงุนุฏุฉ:
- ๐ง ุงูุจุฑูุฏ: support@masaralaqar.com
- ๐ฌ WhatsApp: [ุงูุฑูู]
- ๐ ูููุน ุงูููุจ: masaralaqar.com

---

## ๐ ุงููููุงุช ุงูุฑุฆูุณูุฉ

| ุงูููู | ุงููุตู |
|------|-------|
| [src/lib/payments.ts](src/lib/payments.ts) | ุฌููุน ุงูุนูููุงุช ูุงูุฏูุงู |
| [src/app/pricing/page.tsx](src/app/pricing/page.tsx) | ุนุฑุถ ุงูุฎุทุท |
| [src/app/subscribe/subscribe-content.tsx](src/app/subscribe/subscribe-content.tsx) | ูููุฐุฌ ุงูุฏูุน |
| [src/app/admin/payments/page.tsx](src/app/admin/payments/page.tsx) | ุฅุฏุงุฑุฉ ุงูุฏูุนุงุช |
| [src/app/admin/invoices/page.tsx](src/app/admin/invoices/page.tsx) | ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ |
| [supabase/payment-schema.sql](supabase/payment-schema.sql) | ูุงูุจ ูุงุนุฏุฉ ุงูุจูุงูุงุช |

---

## โ ูุงุฆูุฉ ุงูุชุญูู

- [ ] ุชุดุบูู `payment-schema.sql` ูู Supabase
- [ ] ุชุญุฏูุซ ุจูุงูุงุช ุงูุจูู ุงูุญููููุฉ
- [ ] ุงุฎุชุจุงุฑ ุตูุญุฉ `/pricing`
- [ ] ุงุฎุชุจุงุฑ ุตูุญุฉ `/subscribe`
- [ ] ุงุฎุชุจุงุฑ `/admin/payments` ููุณุคูู
- [ ] ุงูุชุญูู ูู ุชูุนูู ุงูุงุดุชุฑุงู ุชููุงุฆูุงู
- [ ] ุงูุชุญูู ูู ุฅูุดุงุก ุงูููุงุชูุฑ
- [ ] ุชูููู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ูุณุชูุจู)
- [ ] ุชูููู ุงูุฑุณุงุฆู ุงููุตูุฉ (ูุณุชูุจู)
- [ ] ูุดุฑ ุนูู ุงูุฅูุชุงุฌ

---

ุขุฎุฑ ุชุญุฏูุซ: **18 ูุจุฑุงูุฑ 2026**
